!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CKEditor5=e():(t.CKEditor5=t.CKEditor5||{},t.CKEditor5.characterlimit=e())}(self,(()=>(()=>{var t={"ckeditor5/src/core.js":(t,e,r)=>{t.exports=r("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/ui.js":(t,e,r)=>{t.exports=r("dll-reference CKEditor5.dll")("./src/ui.js")},"dll-reference CKEditor5.dll":t=>{"use strict";t.exports=CKEditor5.dll}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var n={};return(()=>{"use strict";r.d(n,{default:()=>a});var t=r("ckeditor5/src/core.js");class e extends t.Plugin{constructor(t){super(t),this.editor=t,this.maxChars=t.config.get("BUFCharacterLimit.maxChars")||500,this.lockEditor=!1!==t.config.get("BUFCharacterLimit.lockEditor"),this.currentLength=0}init(){const t=this.editor;this._setupCharacterCounter(t)}_setupCharacterCounter(t){t.model.document.on("change:data",((t,e)=>{let r,n;return function(){const o=this,i=arguments;n?(clearTimeout(r),r=setTimeout((function(){Date.now()-n>=e&&(t.apply(o,i),n=Date.now())}),e-(Date.now()-n))):(t.apply(o,i),n=Date.now())}})((()=>{this.currentLength=this._getCharacterCount(),t.fire("characterCount",{characters:this.currentLength,maxCharacters:this.maxChars,remaining:this.maxChars-this.currentLength}),this.lockEditor&&this.currentLength>this.maxChars&&this._trimContent(t)}),200))}_trimContent(t){t.model.change((e=>{const r=t.model.document.getRoot();let n="";for(const t of r.getChildren()){n+=this._getTextFromElement(t)}if(n.length>this.maxChars){const t=n.substring(0,this.maxChars);e.remove(e.createRangeIn(r)),e.insertText(t,r,0)}}))}_getCharacterCount(){const t=this.editor.model;let e=0;for(const r of t.document.getRoot().getChildren())e+=this._countCharactersInElement(r);return e}_countCharactersInElement(t){let e=0;for(const r of t.getChildren())r.is("text")?e+=r.data.length:r.is("element")&&(e+=this._countCharactersInElement(r));return e}_getTextFromElement(t){let e="";if(t.is("text"))return t.data;for(const r of t.getChildren())r.is("text")?e+=r.data:r.is("element")&&(e+=this._getTextFromElement(r));return e}}var o=r("ckeditor5/src/ui.js");class i extends t.Plugin{init(){const t=this.editor,e=t.t,r=!1!==t.config.get("BUFCharacterLimit.enabled"),n=!1!==t.config.get("BUFCharacterLimit.showCharacterCount"),i=!1!==t.config.get("BUFCharacterLimit.showRemaining");if(!r||!n&&!i)return;const c=t.config.get("BUFCharacterLimit.maxChars")||500;t.ui.componentFactory.add("characterCounter",(()=>{const r=new o.ButtonView;return r.set({label:"0/"+c,tooltip:e("Character count"),withText:!0,class:"ck-character-counter"}),r.on("render",(()=>{r.element&&r.element.classList.add("ck-character-counter-button")})),r.on("execute",(()=>!1)),t.on("characterCount",((t,e)=>{if(!r.element)return;const{characters:o,remaining:a}=e,s=o>c;let h="";n&&i?h=`${o}/${c}`:n?h=`${o}`:i&&(h=`${a}`),r.set({label:h}),s?r.element.classList.add("ck-character-counter--over-limit"):r.element.classList.remove("ck-character-counter--over-limit")})),r}))}}class c extends t.Plugin{static get requires(){return[e,i]}static get pluginName(){return"BUFCharacterLimit"}}const a={BUFCharacterLimit:c}})(),n=n.default})()));